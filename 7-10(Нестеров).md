### Конспект: Глава 7. Сети

Сеть — это основа инфраструктуры компании. Ошибки, допущенные при проектировании сети, могут негативно сказаться на всех компонентах системы. Сеть не существует в изоляции: решения, принятые при её создании, влияют на внедрение инфраструктурных сервисов. Поэтому при проектировании сети важно консультироваться с ответственными за эти сервисы.

Сетевые технологии стремительно развиваются, и методы их внедрения со временем меняются. Однако основные принципы, такие как надёжность, документирование и масштабируемость, остаются неизменными.

Основная цель при проектировании сети — создать надёжную, документированную, простую в обслуживании систему с высокой пропускной способностью и возможностями для роста. На эту цель влияет множество факторов, включая физическую структуру сети, логическую топологию, маршрутизацию, мониторинг и управление сетью.

Подходы к проектированию локальных и глобальных сетей различаются, но со временем становятся то ближе, то дальше друг от друга. Например, в локальных сетях ранее использовалась топология FDDI (двойное кольцо), которая затем была вытеснена Fast Ethernet с шинной архитектурой. В это время в глобальных сетях набирали популярность кольцевые архитектуры, такие как SONET и MONET. Позже, с развитием технологий, 10-гигабитные локальные сети снова стали использовать кольцевую архитектуру.

### 7.1.1. Модель OSI

Модель OSI (Open Systems Interconnection) представляет собой эталонную модель взаимодействия открытых систем, широко используемую для описания сетей. Она разбивает сеть на логические уровни, каждый из которых отвечает за определённые функции.

- **Физический уровень (1)**: включает физическое подключение устройств через кабели, оптоволокно или беспроводные каналы.
- **Канальный уровень (2)**: отвечает за MAC-адресацию и управление потоком данных.
- **Сетевой уровень (3)**: занимается логической адресацией (например, IP-адресами) и маршрутизацией.
- **Транспортный уровень (4)**: отвечает за доставку данных, проверку ошибок и восстановление соединений.
- **Сеансовый уровень (5)**: управляет сессиями связи.
- **Уровень представления (6)**: отвечает за форматы данных, шифрование и сжатие.
- **Прикладной уровень (7)**: включает протоколы приложений, такие как HTTP, SMTP и FTP.

Техники часто упрощают модель OSI для сетей TCP/IP. На практике границы уровней модели OSI часто размываются. Например, VPN через HTTP-прокси использует трафик уровней 3 и 4 в рамках протокола прикладного уровня (7). Модель OSI полезна для понимания принципов работы сети, но не всегда строго соблюдается в реальных системах.

### 7.1.2. Понятная архитектура

Сетевая архитектура должна быть простой и понятной. Её проектирование должно легко описываться несколькими словами и иллюстрироваться простыми схемами. Понятная архитектура облегчает решение проблем: вы всегда знаете, как проходит трафик между точками, и можете быстро определить, какие каналы влияют на сети. Ясное понимание маршрутов трафика позволяет эффективно управлять сетью, тогда как сложная и непонятная архитектура оставляет всё на волю случая.

Простота архитектуры охватывает физическую и логическую топологии, а также используемые сетевые протоколы. Она позволяет легко масштабировать сеть, добавляя новые сегменты локальной сети или подключая удалённые офисы.

Мы рекомендуем минимизировать количество сетевых протоколов в одной глобальной сети. Большинство компаний в последние годы переходят на использование TCP/IP, отказавшись от комбинирования его с такими протоколами, как Novell IPX или AppleTalk. Если необходимо поддерживать устаревшие протоколы, их можно инкапсулировать в туннели поверх TCP/IP, что обходится дешевле и упрощает инфраструктуру.

### 7.1.3. Топологии сетей

Сетевые топологии меняются вместе с развитием технологий и компаний. Рассмотрим основные типы:

- **Топология звезды**: Центральное устройство или сеть соединяет все остальные узлы.
    
    - Преимущества: простота, экономическая эффективность, удобство масштабирования.
    - Недостатки: уязвимость центра — при его отказе связь нарушается.
    - Улучшения: дублирование центра и избыточные подключения между узлами.
    - Распространённый вариант — несколько звёзд, соединённых высокоскоростными каналами, что минимизирует последствия отказов.
- **Топология кольца**: Каждый узел соединён с двумя соседними, формируя кольцо.
    
    - Преимущества: устойчивость к отказам одного из каналов.
    - Недостатки: сложность управления при увеличении числа узлов.
- **Топология хаоса**: Каждый узел может использовать один или несколько произвольных маршрутов для связи.
    
    - Пример: Интернет.
    - Особенности: высокая адаптивность и отказоустойчивость, сложность описания.
- **Логическая топология**: Отображает сетевые устройства и их взаимодействие. Она должна быть понятной, чтобы архитектор мог изобразить её без помощи.
    

**Примеры топологий на логическом уровне:**

- **Плоская топология**: единая сеть уровня 2 без маршрутизаторов, один домен широковещательной рассылки.
- **Топология на основе местоположения**: сети уровня 2 организуются по физическим зонам, например, этажам здания, с использованием маршрутизаторов уровня 3.
- **Топология на основе функциональных групп**: группы пользователей подключаются к одной сети, независимо от их местоположения.

**Взаимосвязь логики и физики сети**: Логическая топология зависит от физической и влияет на неё. Например, маршрутизация, сервисы (электронная почта, доступ в Интернет) и другие элементы должны быть интегрированы в архитектуру сети.

### Промежуточный кабельный узел (IDF)

Промежуточный кабельный узел, или IDF (Intermediate Distribution Frame), представляет собой сетевой коммутационный шкаф, который используется для подключения настольных компьютеров к сети через систему сетевых шкафов и кабелей. Технологии подключения развиваются постепенно, поэтому важно заранее продумывать выбор оборудования. Использование качественных медных или оптоволоконных кабелей позволяет избежать частой модернизации и дополнительных затрат. Например, выбор кабеля категории 5 вместо устаревшего кабеля категории 3 помогает в будущем сократить расходы на замену инфраструктуры.

Современные IDF оборудованы патч-панелями, которые упрощают подключение кабелей через разъемы RJ-45. Это удобнее по сравнению со старыми системами, где использовались коммутационные блоки, требующие ручного подключения проводов. Для подключения нескольких IDF существует два подхода: либо прокладывать отдельные связки кабелей между узлами, что дорого и неудобно, либо организовать центральный узел (MDF), куда подключаются все IDF, что позволяет значительно упростить кросс-подключения.

Размещение IDF в здании должно быть тщательно продумано. Обычно на каждом этаже требуется по одному IDF, и их размещение рекомендуется планировать строго по одной вертикали. Это облегчает прокладку кабелей между узлами и упрощает обслуживание. Нумерация IDF должна быть систематичной, включать номера здания, этажа и шкафа. Также важно маркировать сетевые разъемы, чтобы упростить диагностику и устранение проблем.

Оборудование IDF должно быть расположено только в сетевых шкафах. Размещение серверов или стороннего оборудования не рекомендуется, так как это увеличивает риск повреждений и затрудняет обслуживание. На этапе строительства здания необходимо предусмотреть запас сетевых разъемов, поскольку прокладка дополнительных кабелей впоследствии обходится значительно дороже.

IDF должны быть закрыты для предотвращения несанкционированного доступа. Важно регулярно проводить инструктажи для сотрудников, которые работают с этими узлами. Оборудование IDF нуждается в защите электропитания от перебоев и скачков напряжения. Использование источников бесперебойного питания (ИБП) помогает избежать проблем с сетью во время отключений электроэнергии. Дополнительно требуется охлаждение шкафов IDF, так как сетевое оборудование выделяет много тепла.

Для удобства управления оборудованием IDF необходимо настроить удаленный консольный доступ с использованием строгой аутентификации. Размещение сетевых разъемов и прокладка кабелей на этапе строительства позволяет сэкономить средства и обеспечить устойчивую работу сети в будущем.

### Точки разграничения и документирование сети

Точка разграничения представляет собой границу между вашей организацией и поставщиком услуг, таким как телефонная компания или интернет-провайдер. Это может быть распределительный шкаф оптоволоконной линии, коммутационные блоки, стойка с щитом, сетевое устройство или даже пластиковая коробка на стене с разъемом для кабеля. Важно знать местоположение точки разграничения, так как телефонная компания несет ответственность только за проводку до этой точки. Если возникают проблемы с линией, необходимо указать технику точку разграничения, чтобы не тратить время на проверку других участков сети. Также стоит иметь возможность тестирования проводки от этой точки до сетевого оборудования.

Сетевое документирование включает в себя несколько видов документации, с основным акцентом на маркировку. Сетевые карты делятся на физические и логические. Карта физической сети отображает путь проводки, местоположение конечных точек и радиус действия беспроводных точек. Если в физической сети предусмотрена избыточность, необходимо четко обозначить и задокументировать разные пути. Также важно обозначить типы и объем подключения для каждого канала, например, количество витых пар или оптоволоконных кабелей между зданиями, их класс и точку подключения.

Логическая карта сети отображает топологию, сетевые номера, имена, скорости, протоколы маршрутизации и административные домены. Оба типа карт должны соответствовать масштабу сети и определять её внешние границы.

Маркировка является ключевым элементом документирования сети. Особенно важными являются ярлыки на патч-панелях и междугородных каналах, которые должны быть четкими и последовательными. На ярлыках для патч-панелей нужно указывать их физическое местоположение и точное подключение каждого кабеля с обеих сторон. Для междугородных линий ярлыки должны включать информацию о направлении линии, контактные данные для устранения проблем и идентификатор цепи. Подобные ярлыки помогут быстро найти нужную информацию при возникновении неисправностей, например, отслеживая кабель от модулей обслуживания канала до монтажных блоков на точке разграничения.

Временные проводки также должны быть промаркированы, однако маркировку следует поддерживать только в случае стабильности окружающей среды. Неверные ярлыки могут создать больше проблем, чем их отсутствие. Одним из компромиссных решений является использование кабелей с уникальными серийными номерами на обоих концах. Эти номера облегчают отслеживание кабелей и могут включать информацию о типе и длине кабеля. Например, можно использовать разноцветные ярлыки на коннекторах для дополнительной идентификации типа кабеля.

Маркировка кабелей — это сложный процесс, однако для этого хорошо подходят самоклеящиеся ярлыки, которые можно быстро прикрепить и, при необходимости, заменить. Кроме того, в процессе документирования важно учитывать онлайн-документирование, которое является частью конфигурации сетевых устройств. Использование комментариев и стандартных имен для устройств в сети помогает значительно упростить администрирование, делая его более интуитивно понятным.

### Простая маршрутизация

Маршрутизацию следует оставлять для маршрутизаторов, а не для узлов сети. Конфигурация узлов должна включать стандартный шлюз, чтобы упрощать процесс маршрутизации. Важно, чтобы маршрутизация в пределах одной площадки была простой, предсказуемой и доступной для диагностики.

В UNIX-системах поддерживаются протоколы маршрутизации, такие как RIP и RIPv2, что позволяет узлам определять, куда отправлять пакеты. Однако раньше, когда большинство узлов использовали UNIX-системы с одним сетевым интерфейсом, протокол RIP не был оптимальным, так как он нагружал процессор и сеть для создания таблицы маршрутизации, которая на самом деле указывала, что используется только один интерфейс для всех пакетов. Это могло привести к сбоям, если узлы передавали неверную маршрутную информацию.

Если маршрутизатор поддерживает такую возможность, важно отключить отправку протоколов маршрутизации в локальные сети, где они не нужны. Это предотвращает ошибки в конфигурации, которые могут привести к неправильной маршрутной информации.

Узел с одним сетевым интерфейсом должен иметь только один стандартный маршрут и не должен принимать динамическую маршрутную информацию. Узел с несколькими сетевыми интерфейсами должен принимать трафик, адресованный ему, и не должен отправлять пакеты от других узлов. Его маршрутизация должна быть статичной и максимально простой. Если узел подключен к нескольким сетям, трафик для одной из них должен направляться через соответствующий интерфейс, а трафик для других сетей — через стандартный маршрутизатор.

Иногда может понадобиться добавить дополнительные статические маршруты для направления трафика по рекомендуемым путям, например, для отправки трафика через маршрутизатор в другой сети. Однако по возможности следует избегать сложных конфигураций.

Простая маршрутизация позволяет избежать непредсказуемых ситуаций, упрощая решение сетевых проблем. Если все узлы настроены одинаково, их поведение будет одинаковым. Внедрение динамической маршрутизации может привести к непредсказуемому поведению всей сети, поэтому стоит ограничить участие узлов в динамической маршрутизации, используя соответствующие механизмы безопасности и аутентификации.

### Сетевые устройства

Для любой современной сети необходимы специализированные сетевые устройства, такие как маршрутизаторы и коммутаторы, а не универсальные узлы, сконфигурированные для маршрутизации. Эти устройства должны быть специально разработаны для выполнения своей основной задачи — передачи пакетов или управления трафиком, а не для выполнения дополнительных функций.

До появления сетевых маршрутизаторов маршрутизация осуществлялась с помощью UNIX-систем с несколькими сетевыми картами. Однако вскоре на рынок вышли устройства от Cisco и других компаний, оптимизированные для маршрутизации, которые значительно повысили производительность сети. Эти устройства снижают задержки, лучше интегрируются с системами управления сетью и мониторинга, а также менее склонны к поломкам, так как имеют меньше подвижных частей.

Маршрутизация пакетов в специализированных устройствах происходит в ядре, что обеспечивает приоритет для этой задачи и минимизирует влияние на другие функции. Например, если маршрутизацию выполняет файловый сервер, увеличение сетевого трафика будет снижать производительность файлового сервиса. Это связано с тем, что ядро, выполняющее маршрутизацию, отнимает ресурсы у других процессов, что не всегда видно при обычной диагностике.

Когда появились брандмауэры, они также изначально представляли собой серверы или рабочие станции с дополнительным программным обеспечением для фильтрации трафика. Позже на рынке появились аппаратные брандмауэры, которые справлялись с большим объемом трафика без потери скорости. Несмотря на то, что программные брандмауэры догнали аппаратные по функциональности, они часто подвергаются риску из-за добавления на тот же сервер других сервисов, что может привести к уязвимостям в безопасности.

Мы предпочитаем использовать аппаратные брандмауэры, так как они выполняют свою задачу по фильтрации трафика, не отвлекаясь на другие функции. Программные решения, хотя и гибкие, часто становятся сложными в обслуживании и поддержке, особенно когда разработчик покидает компанию.

Также следует учитывать, что обновления для сетевых устройств и серверов имеют разные графики. Сетевые устройства обычно требуют меньше обновлений и изменений, в то время как серверы приложений часто обновляются и перезагружаются. Это несоответствие может создавать неудобства при работе с оборудованием.

Наблюдается тревожная тенденция, когда крупные компании, такие как Microsoft, Novell и Apple, поощряют использование универсальных машин в качестве маршрутизаторов или брандмауэров. Однако мы считаем, что это ошибка, и не следует повторять прежние ошибки с использованием универсальных машин для специализированных задач.

### Оверлейные сети

Оверлейная сеть — это логическая топология, которая накладывается на физическую топологию. Примеры оверлейных сетей включают VLAN, Frame Relay и ATM. Этот подход позволяет создавать физически простые, но функционально сложные сети, которые обеспечивают необходимую гибкость и сложность на логическом уровне, при этом сохраняя простоту на физическом слое.

Применение оверлейных сетей позволяет строить однородные и стабильные физические сети, а затем накладывать на них более сложные логические структуры. Например, для глобальной вычислительной сети можно установить единое подключение к ATM или распределенную сеть Frame Relay. После этого можно настроить коммутаторы ATM или Frame Relay так, чтобы между различными площадками создавались виртуальные каналы. Если две удаленные площадки обменяются большим объемом трафика, достаточно просто изменить конфигурацию коммутатора, добавив виртуальный канал между этими площадками.

Одним из популярных вариантов является полная ячеистая топология, где каждая площадка соединена с остальными через виртуальные каналы. Преимущество такого подхода в том, что основная площадка не перегружена трафиком, и компаниям не нужно устанавливать новые физические каналы, что экономит средства.

Для глобальных вычислительных сетей также часто используется туннелирование с шифрованием, например, в виде виртуальных частных сетей (VPN). В этом случае каждая площадка оснащена брандмауэром, VPN-устройством и подключением к Интернету, что позволяет создать ГВС через Интернет. Это позволяет интернет-провайдерам использовать одну стабильную инфраструктуру для множества клиентов.

На уровне локальной сети оверлейные сети обычно означают использование простых физически однородных топологий с протоколом VLAN (IEEE 802.1q) для создания виртуальных подсетей, которые могут быть необходимы пользователям. Для соединения различных участков локальной сети, например, IDF и MDF, могут использоваться высокоскоростные избыточные каналы, которые служат связующим звеном на уровне канала Ethernet с применением протокола STP (Spanning Tree Protocol), обеспечивающего отказоустойчивость.

### 7.1.11. Количество поставщиков

Использование оборудования от множества разных поставщиков может усложнить управление сетью. Чем больше поставщиков предоставляют оборудование, тем больше возникает проблем с интеграцией и взаимодействием между устройствами. Это увеличивает нагрузку на администраторов сети, которым нужно изучить различные конфигурации и особенности оборудования, следить за обновлениями программного обеспечения и отслеживать ошибки. Для повышения надежности и упрощения обслуживания сети рекомендуется минимизировать количество поставщиков, что также может помочь получить скидки за увеличение объема поставок.

Однако сотрудничество с одним поставщиком также имеет свои риски. Нет поставщика, который производил бы лучшую продукцию во всех областях, и полная зависимость от одного поставщика может привести к проблемам с взаимодействием оборудования в случае, если компания решит работать с другим поставщиком. Оптимальным решением является выбор поставщиков по уровням или типам устройств. Например, можно использовать маршрутизаторы от одного поставщика, центральные коммутаторы от другого, а хабы и коммутаторы в офисах — от третьего.

### 7.1.12. Стандартные протоколы

Сеть организации должна строиться с использованием стандартных протоколов, поскольку проприетарные решения связывают вас с конкретным поставщиком, что затрудняет интеграцию с оборудованием других производителей. Это усложняет получение скидок, мешает внедрению инновационных решений и делает вашу инфраструктуру уязвимой для проблем поставщика. Стандарты должны быть проверенными временем и обеспечивать совместимость с оборудованием различных производителей. Использование стандартов IETF, например, снижает риски несовместимости между версиями. В идеале стоит убедить поставщика сделать свои протоколы открытыми, а если они эксклюзивны, попросить его предоставить стандарт или описание, подтверждающее их взаимодействие с другими решениями.

### 7.1.13. Мониторинг

Мониторинг сети — ключевой элемент для обеспечения высокой производительности и надежности сети. Он позволяет своевременно выявлять проблемы, оптимизировать сеть и планировать будущие потребности. Сетевой мониторинг включает два основных типа: мониторинг в реальном времени и сбор статистики для анализа тенденций. Оба типа мониторинга имеют большое значение для провайдеров интернет-услуг, а для корпоративных сетей они также полезны, но не всегда критичны для основного бизнеса.

Мониторинг в реальном времени должен уведомлять администраторов о неисправностях, таких как отказ сетевого интерфейса или проблемы с маршрутизацией. Также важно учитывать аномалии, такие как неожиданные всплески или падения трафика, которые могут свидетельствовать о проблемах с сетью или устройствами. Сбор статистических данных позволяет предсказать будущие потребности в пропускной способности сети и оптимизировать её расширение. Для интернет-провайдеров и компаний, предоставляющих интернет-услуги, важно собирать данные о трафике и определять места для оптимизации и увеличения пропускной способности.

Сбор статистики по сбоям, ошибкам и отказам помогает выявить проблемы и следить за их устранением. Анализ данных помогает обнаружить аномалии в работе сети, что позволяет заранее планировать меры по устранению проблем и оптимизации работы сети.

### 7.2. Тонкости

В дополнение к базовым задачам существуют несколько важных аспектов, которые могут помочь улучшить вашу сеть. Важно найти баланс между внедрением новых технологий и использованием проверенных и надежных решений. Также, если потребуется создать несколько административных единиц, следует следовать рекомендациям, чтобы минимизировать возможные проблемы.

### 7.2.1. Передовые технологии или надежность

Одной из главных целей построения сети является обеспечение её надежности. Более старые решения, которые прошли обширные проверки как с аппаратной, так и с программной стороны, часто отличаются высокой стабильностью, поскольку все ошибки уже исправлены. В отличие от этого, новые решения с улучшенными характеристиками и высокой скоростью подключения могут быть еще не полностью протестированы, что влечет за собой определенные риски.

Чтобы снизить этот риск, можно провести сертификацию новых решений в лаборатории до их внедрения. Это даст уверенность в успешности развертывания перед массовым использованием нового оборудования. Важно документировать процесс установки и стандарты конфигурации. Постепенное развертывание и тестирование в лаборатории помогут обеспечить большую уверенность в новых решениях.

Можно разделить пользователей на разные группы по уровню готовности к риску. Некоторые пользователи могут быть готовы пожертвовать частью надежности в обмен на новые возможности. В этом случае также важно тестировать новое оборудование до внедрения, чтобы избежать проблем.

В некоторых случаях такие группы пользователей могут быть под ответственностью другого отдела. Этот отдел может иметь клиентские группы, которые требуют внедрения новых технологий сразу после их появления. Если это возможно, можно доверить им решение проблем, а самому использовать их опыт. Таким образом, вы можете учиться на их ошибках и избежать повторения их проблем.

Если вы решаете внедрять новейшие технологии, важно уведомить сотрудников, что из-за новизны технологий возможны сбои и простои. Это важно делать заранее, чтобы избежать разочарования пользователей и снижения репутации сети. В случае, если руководство согласится на риски, такие предупреждения должны быть сделаны для конечных пользователей и их руководителей, чтобы избежать обвинений в простоях. Даже в этом случае новое оборудование должно быть тщательно настроено и протестировано в лаборатории перед внедрением в рабочую среду.

### 7.2.2. Несколько административных единиц

В некоторых случаях создание единой административной единицы для управления сетью может быть невозможно по политическим, практическим или соображениям безопасности. В таких ситуациях необходимо использовать другую модель управления сетью. Если различные организации управляют разными частями сети, которые не подчиняются единому органу управления, требуется создание четких границ между этими частями, используя пограничные протоколы маршрутизации, такие как BGP, а также системы безопасности, включая брандмауэры.

Такой подход позволяет обеспечить стабильность маршрутизации и установить известные уровни безопасности для каждой административной единицы независимо от других. Чаще всего используется следующее разделение: одна группа отвечает за подключение к глобальной вычислительной сети, а другая — за подключение к локальной сети. Это оправдано, поскольку для управления этими сетями требуются различные навыки и квалификация.

Если требуется создать несколько административных единиц, это нужно сделать корректно. Действия и решения одной группы администраторов должны быть полностью независимыми от действий других групп, и они не должны оказывать влияния на работу или надежность других сетей. Для этого важно провести совещания для разработки общепринятых стандартов и утвердить комиссию из представителей каждой группы, которая будет отвечать за внедрение ключевых стандартов.